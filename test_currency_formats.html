<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Formatos de Moeda - Excel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #00425F;
            margin-bottom: 20px;
        }

        .instructions {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        button {
            background: #00425F;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }

        button:hover {
            background: #2F6C81;
        }

        .info {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid #DAB177;
        }

        ul {
            margin: 10px 0;
        }

        li {
            margin: 5px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üß™ Teste de Formatos de Moeda para Excel</h1>

        <div class="instructions">
            <h3>üìã Instru√ß√µes:</h3>
            <ol>
                <li>Clique no bot√£o abaixo para gerar o arquivo Excel de teste</li>
                <li>Abra o arquivo gerado no Excel</li>
                <li>Veja qual coluna mostra os valores corretamente sem erros</li>
                <li>Me diga qual "Formato X" funcionou melhor!</li>
            </ol>
        </div>

        <button onclick="generateTestFile()">üìä Gerar Arquivo de Teste</button>

        <div class="info">
            <h4>O arquivo conter√°:</h4>
            <ul>
                <li>12 formatos diferentes de moeda testados</li>
                <li>8 valores de teste cada (positivos, negativos, zero, decimais)</li>
                <li>Cada coluna representa um formato diferente</li>
            </ul>
        </div>
    </div>

    <script type="module">
        import * as ExcelJS from './node_modules/exceljs/dist/exceljs.min.js';

        window.generateTestFile = async function () {
            try {
                const workbook = new ExcelJS.Workbook();
                workbook.creator = 'Currency Format Tester';
                workbook.created = new Date();

                const sheet = workbook.addWorksheet('Teste de Formatos');

                // Test values
                const testValues = [100, 1000, 10000.50, -500.75, 0, 12345.67, -1234.56, 999999.99];

                // Different format patterns to test
                const formats = [
                    { name: 'Formato 1: Simples (Atual)', pattern: 'R$ #,##0.00' },
                    { name: 'Formato 2: Com Espa√ßo', pattern: '"R$ "* #,##0.00' },
                    { name: 'Formato 3: Accounting B√°sico', pattern: '_-"R$ "* #,##0.00_-;-"R$ "* #,##0.00_-;_-"R$ "* "-"_-;_-@_-' },
                    { name: 'Formato 4: Sem H√≠fen Zero', pattern: '_-"R$ "* #,##0.00_-;-"R$ "* #,##0.00_-;_-"R$ "* 0.00_-;_-@_-' },
                    { name: 'Formato 5: Com Red Negative', pattern: '"R$ "#,##0.00;[Red]"R$ "-#,##0.00;"R$ "-";"R$ "@"' },
                    { name: 'Formato 6: Underline Style', pattern: '_ * #,##0.00" R$"_ ;_ * -#,##0.00" R$"_ ;_ * "-"" R$"_ ;_ @_ ' },
                    { name: 'Formato 7: Currency ID', pattern: '[$$-416]#,##0.00' },
                    { name: 'Formato 8: Br Format', pattern: 'R$#,##0.00_);(R$#,##0.00)' },
                    { name: 'Formato 9: Space Align', pattern: '"R$" #,##0.00_);[Red]("R$" #,##0.00)' },
                    { name: 'Formato 10: Accounting Alt', pattern: '_("R$"* #,##0.00_);_("R$"* (#,##0.00);_("R$"* "-"??_);_(@_)' },
                    { name: 'Formato 11: Simple BRL', pattern: 'R$#,##0.00' },
                    { name: 'Formato 12: With Thousands', pattern: '"R$ "#.##0,00' }
                ];

                // Create header
                const headerRow = ['Valor'];
                formats.forEach(f => headerRow.push(f.name));
                sheet.addRow(headerRow);

                // Style header
                const header = sheet.getRow(1);
                header.font = { bold: true, color: { argb: 'FFFFFFFF' } };
                header.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FF0F172A' } };
                header.alignment = { vertical: 'middle', horizontal: 'center' };

                // Add data rows
                testValues.forEach((value, idx) => {
                    const rowData = [value];
                    formats.forEach(() => rowData.push(value));
                    const row = sheet.addRow(rowData);

                    // Apply formats
                    formats.forEach((format, formatIdx) => {
                        const cell = row.getCell(formatIdx + 2);
                        cell.numFmt = format.pattern;
                        cell.alignment = { vertical: 'middle', horizontal: 'right' };
                        if (idx % 2 === 0) {
                            cell.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFF8FAFC' } };
                        }
                    });

                    // Style first column
                    row.getCell(1).numFmt = '#,##0.00';
                    row.getCell(1).alignment = { vertical: 'middle', horizontal: 'center' };
                    row.getCell(1).font = { bold: true };
                    if (idx % 2 === 0) {
                        row.getCell(1).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFE5E7EB' } };
                    }
                });

                // Set column widths
                sheet.getColumn(1).width = 15;
                formats.forEach((_, idx) => { sheet.getColumn(idx + 2).width = 25; });

                // Add instructions
                sheet.addRow([]);
                sheet.addRow(['INSTRU√á√ïES: Veja qual coluna mostra os valores sem erros'])
                    .getCell(1).font = { italic: true, color: { argb: 'FF666666' } };

                // Download
                const buffer = await workbook.xlsx.writeBuffer();
                const blob = new Blob([buffer], {
                    type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
                });
                const url = window.URL.createObjectURL(blob);
                const anchor = document.createElement('a');
                anchor.href = url;
                anchor.download = 'teste_formatos_moeda.xlsx';
                anchor.click();
                window.URL.revokeObjectURL(url);

                alert('‚úÖ Arquivo gerado! Abra e veja qual formato funciona melhor.');
            } catch (error) {
                console.error('Erro:', error);
                alert('‚ùå Erro ao gerar arquivo: ' + error.message);
            }
        };
    </script>
</body>

</html>